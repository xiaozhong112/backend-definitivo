<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>HoneySweeat | Ingresar</title>

    <!-- Tu CSS (mantiene el fondo miel y el estilo del card) -->
    <link rel="stylesheet" href="F_Loging.css" />
    <!-- Iconos -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet"/>

    <style>
      :root{
        --gold:#ffc30b;
        --brown:#4b2e00;
      }

      /* ===== Navbar píldora fija (arriba, centrada) ===== */
      .navbar-pill{
        position: fixed;
        top: 12px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--gold);
        color: var(--brown);
        padding: 10px 16px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        gap: 14px;
        box-shadow: 0 6px 18px rgba(0,0,0,.15);
        z-index: 50;
        font-weight: 600;
      }
      .navbar-pill a{
        color: var(--brown);
        text-decoration: none;
      }
      .navbar-pill a:hover{ opacity: .85; }

      /* separador sutil */
      .dot{ opacity:.5; }

      /* ===== Footer fijo abajo ===== */
      .footer-bar{
        position: fixed;
        bottom: 0;
        left: 0; right: 0;
        background: var(--gold);
        color: var(--brown);
        text-align: center;
        padding: 10px 12px;
        font-weight: 600;
        box-shadow: 0 -6px 18px rgba(0,0,0,.1);
        z-index: 40;
      }

      /* ===== Ajustes del wrapper para que no tape navbar/footer ===== */
      .wrapper{
        margin-top: 70px;     /* despega del navbar */
        margin-bottom: 70px;  /* despega del footer */
      }

      /* ===== Alert de error ===== */
      .alert{
        display:none;
        background: rgba(0,0,0,.35);
        color: #fff;
        border-radius: 8px;
        padding: 10px 12px;
        margin-bottom: 8px;
        text-align: center;
      }
      .alert.show{ display:block; }

      /* Estilos extra para el enlace admin (manteniendo colores) */
      .admin-link {
        text-align: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255,255,255,0.35);
      }
      .admin-link a {
        color: #fff;            /* se ve bien sobre el card miel */
        font-weight: bold;
        text-decoration: underline;
      }
      .admin-link a:hover {
        color: #f8f8f8;
        opacity: .9;
      }
    </style>
  </head>
  <body>
    <!-- NAVBAR PÍLDORA -->
    <div class="navbar-pill">
      <a href="Frontend.html"><strong>HoneySweeat</strong></a>
      <span class="dot">·</span>
      <a href="F_Loging.html">Login</a>
      <span class="dot">·</span>
      <a href="F_Registrar.html">Registrar</a>
      <a href="F_Carrito.html" title="Carrito" style="margin-left:8px;">
        <img src="img/carrito2.png" alt="Carrito" width="26" height="26" style="vertical-align:middle;border-radius:50%;">
      </a>
    </div>

    <!-- FORM LOGIN (usa tus estilos de F_Loging.css) -->
    <div class="wrapper">
      <!-- alerta de error -->
      <div id="alertBox" class="alert"></div>

      <form id="loginForm">
        <h1>Ingresar</h1>

        <div class="input-box">
          <input type="email" id="email" placeholder="Email" required />
          <i class="bx bxs-user"></i>
        </div>

        <div class="input-box">
          <input type="password" id="password" placeholder="Contraseña" required />
          <i class="bx bxs-lock-alt"></i>
        </div>

        <div class="remember-forgot">
          <label><input type="checkbox" id="remember"/> Recordarme</label>
          <a class="nav-link" href="F_OLvidarC.html">Olvidar contraseña</a>
        </div>

        <button type="submit" class="btn">Aceptar</button>

        <div class="register-link">
          <a class="nav-link" href="F_Registrar.html">Registrar</a>
        </div>
        
      </form>
    </div>

    <!-- FOOTER -->
    <div class="footer-bar">
      HoneySweeat © 2025 — Miel natural
    </div>

    <script>
      // ===== Helper alert
      const alertBox = document.getElementById("alertBox");
      function showError(msg){
        alertBox.textContent = msg;
        alertBox.classList.add("show");
      }
      function hideError(){
        alertBox.classList.remove("show");
        alertBox.textContent = "";
      }

      // ===== Autocompletar admin demo
      document.getElementById("adminAccess").addEventListener("click", (e)=>{
        e.preventDefault();
        document.getElementById("email").value = "admin@miel.cl";
        document.getElementById("password").value = "secreto123";
      });

      // ===== Login contra backend
      // Si sirves el frontend con el mismo backend (express.static), deja vacío:
      const API_BASE = ""; 
      // Si lo abres con Live Server: const API_BASE = "http://localhost:4000";

      document.getElementById("loginForm").addEventListener("submit", async (event)=>{
        event.preventDefault();
        hideError();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        if(!email || !password){ showError("Completa correo y contraseña."); return; }

        try{
          const resp = await fetch(`${API_BASE}/api/auth/login`,{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ email, password })
          });

          if(!resp.ok){
            const err = await resp.json().catch(()=>({error:"Error desconocido"}));
            throw new Error(err.error || "Credenciales inválidas");
          }

          const data = await resp.json(); // { token, user:{id,name,email,role} }
          localStorage.setItem("token", data.token);
          localStorage.setItem("user", JSON.stringify(data.user));
          localStorage.setItem("userRole", data.user?.role || "user");

          // Redirección por rol
          if(data.user?.role === "admin"){
            location.href = "F_Loging_Admin.html"; // o tu dashboard admin
          }else{
            location.href = "Frontend.html";       // home
          }
        }catch(e){
          showError(e.message || "No se pudo iniciar sesión");
        }
      });
    </script>

    <script src="js/login.js" defer></script>

    
  </body>
</html>
